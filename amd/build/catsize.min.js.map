{"version":3,"sources":["../src/catsize.js"],"names":["Selectors","catToggle","courseToggle","init","sortorder","sortdir","displaysize","excludebackups","expander","type","id","selector","document","getElementById","style","display","then","string","pix","html","innerHTML","$","ajax","url","data","course","sorder","sdir","done","registerEventListeners","addEventListener","e","target","attr","parentNode","closest","preventDefault","getAttribute"],"mappings":"gMAuBA,uD,GAKMA,CAAAA,CAAS,CAAG,CACdC,SAAS,CAAE,YADG,CAEdC,YAAY,CAAE,eAFA,C,QAKE,QAAPC,CAAAA,IAAO,CAACC,CAAD,CAAYC,CAAZ,CAAqBC,CAArB,CAAkCC,CAAlC,CAAqD,IAE/DC,CAAAA,CAAQ,CAAG,SAACC,CAAD,CAAOC,CAAP,CAAc,CAC3B,GAAMC,CAAAA,CAAQ,CAAW,KAAR,EAAAF,CAAI,CAAYT,CAAS,CAACC,SAAtB,CAAkCD,CAAS,CAACE,YAAjE,CAEA,GAAwD,OAApD,EAAAU,QAAQ,CAACC,cAAT,CAAwBJ,CAAI,CAAGC,CAA/B,EAAmCI,KAAnC,CAAyCC,OAA7C,CAAiE,CAC7DH,QAAQ,CAACC,cAAT,CAAwBJ,CAAI,CAAGC,CAA/B,EAAmCI,KAAnC,CAAyCC,OAAzC,CAAmD,MAAnD,CACA,iBAAW,UAAX,CAAuB,mBAAvB,EAA4CC,IAA5C,CAAiD,SAAUC,CAAV,CAAkB,CAC/D,gBAAU,eAAV,CAA2B,MAA3B,CAAmCA,CAAnC,EAA2CD,IAA3C,CAAgD,SAAUE,CAAV,CAAe,CAC3D,cAAEP,CAAQ,CAAG,WAAX,CAAyBD,CAAzB,CAA8B,GAAhC,EAAqCS,IAArC,CAA0CD,CAA1C,CACH,CAFD,CAGH,CAJD,CAKH,CAPD,IAOO,CACH,GAAoD,EAAhD,EAAAN,QAAQ,CAACC,cAAT,CAAwBJ,CAAI,CAAGC,CAA/B,EAAmCU,SAAvC,CAAwD,CACpD,GAAU,CAAN,EAAAV,CAAJ,CAAa,CACT,iBAAW,SAAX,CAAsB,MAAtB,EAA8BM,IAA9B,CAAmC,SAAUC,CAAV,CAAkB,CACjD,gBAAU,WAAV,CAAuB,MAAvB,CAA+BA,CAA/B,EAAuCD,IAAvC,CAA4C,SAAUE,CAAV,CAAe,CACvD,cAAEP,CAAQ,CAAG,WAAX,CAAyBD,CAAzB,CAA8B,GAAhC,EAAqCS,IAArC,CAA0CD,CAA1C,CACH,CAFD,CAGH,CAJD,CAKH,CACDG,UAAEC,IAAF,CAAO,CACHb,IAAI,CAAE,KADH,CAEHc,GAAG,CAAE,kBAAY,iCAAZ,CAFF,CAGHC,IAAI,CAAE,CACFd,EAAE,CAAEA,CADF,CAEFe,MAAM,CAAU,KAAR,EAAAhB,CAAI,CAAY,CAAZ,CAAgB,CAF1B,CAGFiB,MAAM,CAAEtB,CAHN,CAIFuB,IAAI,CAAEtB,CAJJ,CAKFU,OAAO,CAAET,CALP,CAMFC,cAAc,CAAEA,CANd,CAHH,CAAP,EAWGqB,IAXH,CAWQ,SAAUJ,CAAV,CAAgB,CACpBZ,QAAQ,CAACC,cAAT,CAAwBJ,CAAI,CAAGC,CAA/B,EAAmCU,SAAnC,CAA+CI,CAA/C,CACAZ,QAAQ,CAACC,cAAT,CAAwBJ,CAAI,CAAGC,CAA/B,EAAmCI,KAAnC,CAAyCC,OAAzC,CAAmD,OAAnD,CACA,GAAU,CAAN,EAAAL,CAAJ,CAAa,CACT,iBAAW,UAAX,CAAuB,mBAAvB,EAA4CM,IAA5C,CAAiD,SAAUC,CAAV,CAAkB,CAC/D,gBAAU,gBAAV,CAA4B,MAA5B,CAAoCA,CAApC,EAA4CD,IAA5C,CAAiD,SAAUE,CAAV,CAAe,CAC5D,cAAEP,CAAQ,CAAG,WAAX,CAAyBD,CAAzB,CAA8B,GAAhC,EAAqCS,IAArC,CAA0CD,CAA1C,CACH,CAFD,CAGH,CAJD,CAKH,CACJ,CArBD,CAsBH,CA9BD,IA8BO,CACHN,QAAQ,CAACC,cAAT,CAAwBJ,CAAI,CAAGC,CAA/B,EAAmCI,KAAnC,CAAyCC,OAAzC,CAAmD,OAAnD,CACA,GAAU,CAAN,EAAAL,CAAJ,CAAa,CACT,iBAAW,UAAX,CAAuB,mBAAvB,EAA4CM,IAA5C,CAAiD,SAAUC,CAAV,CAAkB,CAC/D,gBAAU,gBAAV,CAA4B,MAA5B,CAAoCA,CAApC,EAA4CD,IAA5C,CAAiD,SAAUE,CAAV,CAAe,CAC5D,cAAEP,CAAQ,CAAG,WAAX,CAAyBD,CAAzB,CAA8B,GAAhC,EAAqCS,IAArC,CAA0CD,CAA1C,CACH,CAFD,CAGH,CAJD,CAKH,CACJ,CACJ,CACJ,CAtDoE,CAsHrEV,CAAQ,CAAC,KAAD,CAAQ,CAAR,CAAR,CACA,CApB+B,QAAzBqB,CAAAA,sBAAyB,EAAM,CACjCjB,QAAQ,CAACkB,gBAAT,CAA0B,OAA1B,CAAmC,SAAAC,CAAC,CAAI,CACpC,GAAIC,CAAAA,CAAM,CAAGD,CAAC,CAACC,MAAf,CACA,GAAI,cAAEA,CAAF,EAAUC,IAAV,CAAe,SAAf,UAAJ,CAA6C,CACzCD,CAAM,CAAGD,CAAC,CAACC,MAAF,CAASE,UACrB,CACD,GAAIH,CAAC,CAACC,MAAF,CAASG,OAAT,CAAiBnC,CAAS,CAACC,SAA3B,CAAJ,CAA2C,CACvC8B,CAAC,CAACK,cAAF,GACA5B,CAAQ,CAAC,KAAD,CAAQwB,CAAM,CAACK,YAAP,CAAoB,SAApB,CAAR,CAAR,CACA,MACH,CACD,GAAIN,CAAC,CAACC,MAAF,CAASG,OAAT,CAAiBnC,CAAS,CAACE,YAA3B,CAAJ,CAA8C,CAC1C6B,CAAC,CAACK,cAAF,GACA5B,CAAQ,CAAC,QAAD,CAAWwB,CAAM,CAACK,YAAP,CAAoB,SAApB,CAAX,CAEX,CACJ,CAfD,CAgBH,CAGD,GACH,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to handle report_coursesize actions.\n *\n * @package    report_coursesize\n * @copyright  Copyright (c) 2021 Open LMS (https://www.openlms.net)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport {get_string} from 'core/str';\nimport {renderPix} from 'core/templates';\nimport {relativeUrl} from 'core/url';\n\nconst Selectors = {\n    catToggle: \".cattoggle\",\n    courseToggle: \".coursetoggle\",\n};\n\nexport const init = (sortorder, sortdir, displaysize, excludebackups) => {\n\n    const expander = (type, id) => {\n        const selector = type == 'cat' ? Selectors.catToggle : Selectors.courseToggle;\n\n        if (document.getElementById(type + id).style.display == 'block') {\n            document.getElementById(type + id).style.display = 'none';\n            get_string('tdtoggle', 'report_coursesize').then(function (string) {\n                renderPix('t/switch_plus', 'core', string).then(function (pix) {\n                    $(selector + '[data-id=' + id + ']').html(pix);\n                });\n            });\n        } else {\n            if (document.getElementById(type + id).innerHTML == '') {\n                if (id != 0) {\n                    get_string('loading', 'core').then(function (string) {\n                        renderPix('i/loading', 'core', string).then(function (pix) {\n                            $(selector + '[data-id=' + id + ']').html(pix);\n                        });\n                    });\n                }\n                $.ajax({\n                    type: 'GET',\n                    url: relativeUrl('/report/coursesize/callback.php'),\n                    data: {\n                        id: id,\n                        course: type == 'cat' ? 0 : 1,\n                        sorder: sortorder,\n                        sdir: sortdir,\n                        display: displaysize,\n                        excludebackups: excludebackups,\n                    },\n                }).done(function (data) {\n                    document.getElementById(type + id).innerHTML = data;\n                    document.getElementById(type + id).style.display = 'block';\n                    if (id != 0) {\n                        get_string('tdtoggle', 'report_coursesize').then(function (string) {\n                            renderPix('t/switch_minus', 'core', string).then(function (pix) {\n                                $(selector + '[data-id=' + id + ']').html(pix);\n                            });\n                        });\n                    }\n                });\n            } else {\n                document.getElementById(type + id).style.display = 'block';\n                if (id != 0) {\n                    get_string('tdtoggle', 'report_coursesize').then(function (string) {\n                        renderPix('t/switch_minus', 'core', string).then(function (pix) {\n                            $(selector + '[data-id=' + id + ']').html(pix);\n                        });\n                    });\n                }\n            }\n        }\n    };\n\n    const coursesize = (id) => {\n        if (document.getElementById('course' + id).style.display == 'block') {\n            document.getElementById('course' + id).style.display = 'none';\n            document.getElementById('iconcourse' + id).innerHTML = '<img src=\"' +\n                relativeUrl('/report/coursesize/pix/switch_plus.gif') +\n                '\" width=\"16\" height=\"16\" onclick=\"coursesize('+id+')\" style=\"cursor:pointer\">';\n        } else {\n            if (document.getElementById('course' + id).innerHTML == '') {\n                if (id != 0) {\n                    document.getElementById('icon' + id).innerHTML = '<img src=\"' +\n                        relativeUrl('/report/coursesize/pix/loading_spinner.gif')+'\" width=\"16\" height=\"16\">';\n                }\n                $.ajax({\n                    type: 'GET',\n                    url: relativeUrl('/report/coursesize/callback.php'),\n                    data: {\n                        id: id,\n                        course: 1,\n                        sorder: sortorder,\n                        sdir: sortdir,\n                        display: displaysize,\n                        excludebackups: excludebackups,\n                    },\n                }).done(function (data) {\n                    document.getElementById('course' + id).innerHTML = data;\n                    document.getElementById('course' + id).style.display = 'block';\n                    if (id != 0) {\n                        document.getElementById('iconcourse' + id).innerHTML = '<img src=\"' +\n                            relativeUrl('/report/coursesize/pix/switch_minus.gif') +\n                            '\" width=\"16\" height=\"16\" onclick=\"coursesize('+id+')\" style=\"cursor:pointer\">';\n                    }\n                });\n            } else {\n                document.getElementById('course' + id).style.display = 'block';\n                if (id != 0) {\n                    document.getElementById('icon' + id).innerHTML = '<img src=\"' +\n                        relativeUrl('/report/coursesize/pix/switch_minus.gif') +\n                        '\" width=\"16\" height=\"16\" onclick=\"coursesize('+id+')\" style=\"cursor:pointer\">';\n                }\n            }\n        }\n    };\n\n    const registerEventListeners = () => {\n        document.addEventListener('click', e => {\n            var target = e.target;\n            if ($(target).attr('data-id') === undefined) {\n                target = e.target.parentNode;\n            }\n            if (e.target.closest(Selectors.catToggle)) {\n                e.preventDefault();\n                expander('cat', target.getAttribute('data-id'));\n                return;\n            }\n            if (e.target.closest(Selectors.courseToggle)) {\n                e.preventDefault();\n                expander('course', target.getAttribute('data-id'));\n                return;\n            }\n        });\n    };\n\n    expander('cat', 0);\n    registerEventListeners();\n};"],"file":"catsize.min.js"}